name: Auto Deploy Development

on:
  push:
    branches: [ develop ]

jobs:
  deploy-dev:
    runs-on: windows-latest
    if: github.ref == 'refs/heads/develop'
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
        
    - name: Build and Publish
      run: |
        dotnet restore ReturnToMoriaServerManager.sln
        dotnet build ReturnToMoriaServerManager.sln --configuration Release
        dotnet publish ReturnToMoriaServerManager/ReturnToMoriaServerManager.csproj --configuration Release --output ./publish --self-contained false
        
    - name: Create Package
      run: |
        $version = "dev-${{ github.sha }}"
        $packageName = "ReturnToMoriaServerManager-$version.zip"
        
        New-Item -ItemType Directory -Path "./package" -Force
        Copy-Item -Path "./publish/*" -Destination "./package/" -Recurse
        Copy-Item -Path "./README.md" -Destination "./package/"
        Copy-Item -Path "./LICENSE" -Destination "./package/"
        
        Compress-Archive -Path "./package/*" -DestinationPath "./$packageName" -Force
        
    - name: Create Development Release
      uses: softprops/action-gh-release@v2
      with:
        tag_name: dev-${{ github.sha }}
        name: Development Build ${{ github.sha }}
        body: |
          ## Development Build
          
          This is an automatic development build from the `develop` branch.
          
          **Commit:** ${{ github.sha }}
          **Branch:** ${{ github.ref_name }}
          **Date:** ${{ github.event.head_commit.timestamp }}
          
          ### Download
          Download the latest development build from the assets below.
          
          ### Installation
          1. Extract the ZIP file
          2. Run `ReturnToMoriaServerManager.exe`
          3. Follow the setup wizard
          
          ### Note
          This is a development build and may contain bugs or incomplete features.
        files: |
          ./ReturnToMoriaServerManager-dev-${{ github.sha }}.zip
        draft: false
        prerelease: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} 